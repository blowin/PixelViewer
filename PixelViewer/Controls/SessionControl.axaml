<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:c="using:CarinaStudio"
			 xmlns:aConverters="using:Avalonia.Data.Converters"
			 xmlns:asControls="using:CarinaStudio.AppSuite.Controls"
			 xmlns:asConverters="using:CarinaStudio.AppSuite.Converters"
			 xmlns:app="using:Carina.PixelViewer"
             xmlns:appControls="clr-namespace:Carina.PixelViewer.Controls"
             xmlns:appConverters="clr-namespace:Carina.PixelViewer.Data.Converters"
             xmlns:appImageRenderers="clr-namespace:Carina.PixelViewer.Media.ImageRenderers"
             xmlns:appMedia="clr-namespace:Carina.PixelViewer.Media"
			 xmlns:appProfiles="using:Carina.PixelViewer.Media.Profiles"
			 xmlns:appViewModels="clr-namespace:Carina.PixelViewer.ViewModels"
			 xmlns:ia="using:Avalonia.Xaml.Interactivity"
             xmlns:iaCore="using:Avalonia.Xaml.Interactions.Core"
			 xmlns:sys="using:System"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Carina.PixelViewer.Controls.SessionControl"
			 Background="{DynamicResource Brush/Window.Background}">
	
	<!-- Resources -->
	<UserControl.Resources>

		<!-- Evaluate image dimensions -->
		<ContextMenu x:Key="evaluateImageDimensionsMenu" PlacementMode="Bottom">
			<MenuItem Command="{Binding EvaluateImageDimensionsCommand}" CommandParameter="{x:Static appMedia:AspectRatio.Unknown}" Header="{DynamicResource String/AspectRatio.Unknown}"/>
			<Separator/>
			<MenuItem Command="{Binding EvaluateImageDimensionsCommand}" CommandParameter="{x:Static appMedia:AspectRatio.Ratio_4x3}" Header="4:3"/>
			<MenuItem Command="{Binding EvaluateImageDimensionsCommand}" CommandParameter="{x:Static appMedia:AspectRatio.Ratio_16x9}" Header="16:9"/>
			<MenuItem Command="{Binding EvaluateImageDimensionsCommand}" CommandParameter="{x:Static appMedia:AspectRatio.Ratio_3x2}" Header="3:2"/>
			<MenuItem Command="{Binding EvaluateImageDimensionsCommand}" CommandParameter="{x:Static appMedia:AspectRatio.Ratio_1x1}" Header="1:1"/>
			<Separator/>
			<MenuItem Command="{Binding EvaluateImageDimensionsCommand}" CommandParameter="{x:Static appMedia:AspectRatio.Ratio_3x4}" Header="3:4"/>
			<MenuItem Command="{Binding EvaluateImageDimensionsCommand}" CommandParameter="{x:Static appMedia:AspectRatio.Ratio_9x16}" Header="9:16"/>
			<MenuItem Command="{Binding EvaluateImageDimensionsCommand}" CommandParameter="{x:Static appMedia:AspectRatio.Ratio_2x3}" Header="2:3"/>
		</ContextMenu>

		<!-- File actions -->
		<ContextMenu x:Key="fileActionsMenu" PlacementMode="Top">
			<MenuItem Command="{Binding $parent[UserControl].CopyFileName}" Header="{DynamicResource String/SessionControl.CopyFileName}">
				<MenuItem.Icon>
					<Image Classes="MenuItem_Icon" Source="{DynamicResource Image/Icon.Copy}"/>
				</MenuItem.Icon>
			</MenuItem>
			<MenuItem Command="{Binding $parent[UserControl].CopyFilePath}" Header="{DynamicResource String/SessionControl.CopyFilePath}">
				<MenuItem.Icon>
					<Image Classes="MenuItem_Icon" Source="{DynamicResource Image/Icon.Copy}"/>
				</MenuItem.Icon>
			</MenuItem>
			<Separator/>
			<MenuItem Command="{Binding $parent[UserControl].ShowSourceFileInFileExplorer}" Header="{DynamicResource String/SessionControl.ShowFileInExplorer}" IsEnabled="{x:Static c:Platform.IsOpeningFileManagerSupported}">
				<MenuItem.Icon>
					<Image Classes="MenuItem_Icon" Source="{DynamicResource Image/Icon.FileManager}"/>
				</MenuItem.Icon>
			</MenuItem>
		</ContextMenu>

		<!-- Other actions -->
		<ContextMenu x:Key="otherActionsMenu" PlacementMode="Bottom">
			<MenuItem Command="{Binding $parent[Window].ShowAppOptions}" Header="{DynamicResource String/SessionControl.ApplicationOptions}">
				<MenuItem.Icon>
					<Image Classes="MenuItem_Icon" Source="{DynamicResource Image/Icon.Settings}"/>
				</MenuItem.Icon>
			</MenuItem>
			<MenuItem Command="{Binding $parent[Window].CheckForAppUpdate}" Header="{DynamicResource String/SessionControl.CheckForApplicationUpdate}">
				<MenuItem.Icon>
					<Panel>
						<Image Classes="MenuItem_Icon" IsVisible="{Binding $parent[Window].Application.UpdateInfo, Converter={x:Static asConverters:ValueToBooleanConverters.NullToTrue}}" Source="{DynamicResource Image/Icon.Update}"/>
						<Image Classes="MenuItem_Icon" IsVisible="{Binding $parent[Window].Application.UpdateInfo, Converter={x:Static asConverters:ValueToBooleanConverters.NonNullToTrue}}" Source="{DynamicResource Image/Icon.Update.Colored}"/>
					</Panel>
				</MenuItem.Icon>
			</MenuItem>
			<MenuItem Name="editConfigMenuItem" Command="{Binding $parent[Window].ShowConfigurationEditor}" Header="Edit Configurationsâ€¦" IsVisible="False"/>
			<Separator/>
			<MenuItem Command="{Binding $parent[Window].CreateMainWindow}" Header="{DynamicResource String/Common.CreateWindow}" InputGesture="Ctrl+N">
				<MenuItem.Icon>
					<Image Classes="MenuItem_Icon" Source="{DynamicResource Image/Icon.AddWindow}"/>
				</MenuItem.Icon>
			</MenuItem>
			<Separator/>
			<MenuItem Command="{Binding $parent[Window].LayoutMainWindowsCommand}" CommandParameter="{x:Static asControls:MultiWindowLayout.Horizontal}" Header="{DynamicResource String/MainWindow.LayoutMainWindows.Horizontal}">
				<MenuItem.Icon>
					<Image Classes="MenuItem_Icon" Source="{DynamicResource Image/Icon.Layout.Horizontal}"/>
				</MenuItem.Icon>
			</MenuItem>
			<MenuItem Command="{Binding $parent[Window].LayoutMainWindowsCommand}" CommandParameter="{x:Static asControls:MultiWindowLayout.Vertical}" Header="{DynamicResource String/MainWindow.LayoutMainWindows.Vertical}">
				<MenuItem.Icon>
					<Image Classes="MenuItem_Icon" Source="{DynamicResource Image/Icon.Layout.Vertical}"/>
				</MenuItem.Icon>
			</MenuItem>
			<MenuItem Command="{Binding $parent[Window].LayoutMainWindowsCommand}" CommandParameter="{x:Static asControls:MultiWindowLayout.Tile}" Header="{DynamicResource String/MainWindow.LayoutMainWindows.Tile}">
				<MenuItem.Icon>
					<Image Classes="MenuItem_Icon" Source="{DynamicResource Image/Icon.Layout.Tile}"/>
				</MenuItem.Icon>
			</MenuItem>
			<Separator/>
			<MenuItem Command="{Binding $parent[Window].ShowAppInfo}" Header="{DynamicResource String/SessionControl.ApplicationInfo}"/>
		</ContextMenu>
		
	</UserControl.Resources>

	<!-- Content -->
	<Grid RowDefinitions="Auto,*,Auto">

		<!-- Tool bar -->
		<Border Classes="ToolBar">
			<Grid ColumnDefinitions="*,Auto">

				<!-- Image actions -->
				<asControls:ToolBarScrollViewer>
					<StackPanel Background="{x:Static Brushes.Transparent}" Orientation="Horizontal">

						<!-- Open file -->
						<Button Classes="ToolBar_Button" Command="{Binding $parent[UserControl].OpenSourceFileCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.OpenSourceFile}">
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.OpenFile}"/>
						</Button>

						<!-- Save image -->
						<Button Classes="ToolBar_Button" Command="{Binding $parent[UserControl].SaveImageCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.SaveImage}">
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.Save}"/>
						</Button>

						<!-- Separator -->
						<Separator Classes="ToolBar_Separator"/>

						<!-- Fit to viewport -->
						<ToggleButton Classes="ToolBar_ToggleButton" IsChecked="{Binding FitImageToViewport, Mode=TwoWay}" IsEnabled="{Binding IsSourceFileOpened}" ToolTip.Tip="{DynamicResource String/SessionControl.FitRenderedImageToViewport}">
							<Panel>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.FitToScreen}" IsVisible="{Binding !$parent[ToggleButton].IsChecked}"/>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.FitToScreen.Light}" IsVisible="{Binding $parent[ToggleButton].IsChecked}"/>
							</Panel>
						</ToggleButton>

						<!-- Zoom-out -->
						<RepeatButton Name="zoomOutButton" Classes="ToolBar_RepeatButton" Command="{Binding ZoomOutCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.ZoomOut}">
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.ZoomOut}"/>
						</RepeatButton>

						<!-- Zoom -->
						<Panel>
							<Panel.IsEnabled>
								<MultiBinding Converter="{x:Static aConverters:BoolConverters.Or}">
									<Binding Path="IsEffectivelyEnabled" ElementName="zoomOutButton"/>
									<Binding Path="IsEffectivelyEnabled" ElementName="zoomInButton"/>
								</MultiBinding>
							</Panel.IsEnabled>
							<TextBlock Classes="ToolBar_TextBlock" Opacity="0" Text="0000%"/>
							<TextBlock Classes="ToolBar_TextBlock" HorizontalAlignment="Center" Text="{Binding RequestedImageDisplayScale, Converter={x:Static asConverters:RatioToPercentageConverter.Default}}"/>
						</Panel>

						<!-- Zoom-in -->
						<RepeatButton Name="zoomInButton" Classes="ToolBar_RepeatButton" Command="{Binding ZoomInCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.ZoomIn}">
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.ZoomIn}"/>
						</RepeatButton>

						<!-- Separator -->
						<Separator Classes="ToolBar_Separator"/>

						<!-- Rotate-left -->
						<Button Name="rotateLeftButton" Classes="ToolBar_Button" Command="{Binding RotateLeftCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.RotateLeft}">
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.RotateLeft}"/>
						</Button>

						<!-- Rotation -->
						<Panel>
							<Panel.IsEnabled>
								<MultiBinding Converter="{x:Static aConverters:BoolConverters.Or}">
									<Binding Path="IsEffectivelyEnabled" ElementName="rotateLeftButton"/>
									<Binding Path="IsEffectivelyEnabled" ElementName="rotateRightButton"/>
								</MultiBinding>
							</Panel.IsEnabled>
							<TextBlock Classes="ToolBar_TextBlock" Opacity="0" Text="0000"/>
							<TextBlock Classes="ToolBar_TextBlock" HorizontalAlignment="Center" Text="{Binding ImageDisplayRotation, Converter={x:Static appConverters:DegreesToStringConverter.Default}}"/>
						</Panel>

						<!-- Rotate-right -->
						<Button Name="rotateRightButton" Classes="ToolBar_Button" Command="{Binding RotateRightCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.RotateRight}">
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.RotateRight}"/>
						</Button>

						<!-- Separator -->
						<Separator Classes="ToolBar_Separator"/>

						<!-- Histograms -->
						<ToggleButton Name="histogramsButton" Classes="ToolBar_ToggleButton" IsChecked="{Binding IsHistogramsVisible, Mode=TwoWay}" IsEnabled="{Binding !$parent[UserControl].IsHistogramsDisabled}" ToolTip.Tip="{DynamicResource String/SessionControl.Histograms}">
							<Panel>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Histogram}" IsVisible="{Binding !$parent[ToggleButton].IsChecked}"/>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Histogram.Light}" IsVisible="{Binding $parent[ToggleButton].IsChecked}"/>
							</Panel>
						</ToggleButton>

						<!-- Separator -->
						<Separator Classes="ToolBar_Separator"/>

						<!-- Frame navigation -->
						<StackPanel Orientation="Horizontal">

							<!-- First frame -->
							<Button Classes="ToolBar_Button" Command="{Binding MoveToFirstFrameCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.MoveToFirstFrame}">
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.FastBackward}"/>
							</Button>

							<!-- Previous frame -->
							<RepeatButton Classes="ToolBar_RepeatButton" Command="{Binding MoveToPreviousFrameCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.MoveToPreviousFrame}">
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Backward}"/>
							</RepeatButton>

							<!-- Frame -->
							<Button Classes="ToolBar_Button" Command="{Binding $parent[UserControl].MoveToSpecificFrame}" IsEnabled="{Binding HasMultipleFrames}" ToolTip.Tip="{DynamicResource String/SessionControl.MoveToSpecificFrame}" Width="NaN">
								<Panel>
									<TextBlock Classes="ToolBar_TextBlock" Opacity="0" Text="000 / 000"/>
									<TextBlock Classes="ToolBar_TextBlock" HorizontalAlignment="Center">
										<TextBlock.Text>
											<MultiBinding StringFormat="{}{0} / {1}">
												<Binding Path="FrameNumber"/>
												<Binding Path="FrameCount"/>
											</MultiBinding>
										</TextBlock.Text>
									</TextBlock>
								</Panel>
							</Button>

							<!-- Next frame -->
							<RepeatButton Classes="ToolBar_RepeatButton" Command="{Binding MoveToNextFrameCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.MoveToNextFrame}">
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Forward}"/>
							</RepeatButton>

							<!-- Last frame -->
							<Button Classes="ToolBar_Button" Command="{Binding MoveToLastFrameCommand}" ToolTip.Tip="{DynamicResource String/SessionControl.MoveToLastFrame}">
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.FastForward}"/>
							</Button>

						</StackPanel>

						<!-- Separator -->
						<Separator Classes="ToolBar_Separator"/>

						<!-- Brightness and contrast adjustment -->
						<ToggleButton Name="brightnessAndContrastAdjustmentButton" Classes="ToolBar_ToggleButton" Command="{Binding $parent[UserControl].OpenBrightnessAndContrastAdjustmentPopup}" IsEnabled="{Binding IsBrightnessAdjustmentSupported}" ToolTip.Tip="{DynamicResource String/SessionControl.BrightnessAndContrastAdjustment}">
							<Panel>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Contrast}" IsVisible="{Binding !$parent[ToggleButton].IsChecked}"/>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Contrast.Active}" IsVisible="{Binding HasBrightnessAdjustment}">
									<Image.IsVisible>
										<MultiBinding Converter="{x:Static aConverters:BoolConverters.Or}">
											<Binding Path="HasBrightnessAdjustment"/>
											<Binding Path="HasContrastAdjustment"/>
											<Binding Path="HasHighlightAdjustment"/>
											<Binding Path="HasShadowAdjustment"/>
										</MultiBinding>
									</Image.IsVisible>
								</Image>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Contrast.Light}" IsVisible="{Binding $parent[ToggleButton].IsChecked}"/>
								<Popup Name="brightnessAndContrastAdjustmentPopup" Classes="SessionControl_FilterParamsPopup">
									<Border Name="brightnessAndContrastAdjustmentPopupBorder" Classes="SessionControl_FilterParamsPopup">
										<DockPanel>
											<Border DockPanel.Dock="Bottom" Padding="{DynamicResource Thickness/Dialog.ControlButtonsPanel.Padding}">
												<Button Classes="Dialog_ControlButton" Command="{Binding $parent[UserControl].ResetBrightnessAndContrastAdjustmentCommand}" Content="{DynamicResource String/Common.Reset}" HorizontalAlignment="Center"/>
											</Border>
											<StackPanel Classes="Dialog_ContentPanel">

												<!-- Brightness -->
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.BrightnessAndContrastAdjustment.Label.Brightness}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding BrightnessAdjustment, StringFormat={}{0:+0.00;-0.00} EV}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="brightnessAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Maximum="2" Minimum="-2" TickFrequency="0.05" Value="{Binding BrightnessAdjustment, Mode=TwoWay}"/>
												<Separator Classes="Dialog_Separator_Small"/>

												<!-- Contrast -->
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.BrightnessAndContrastAdjustment.Label.Contrast}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding ContrastAdjustment, StringFormat={}{0:+0.00;-0.00}}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="contrastAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Maximum="1" Minimum="-1" TickFrequency="0.01" Value="{Binding ContrastAdjustment, Mode=TwoWay}"/>
												<Separator Classes="Dialog_Separator_Small"/>

												<!-- Highlight -->
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.BrightnessAndContrastAdjustment.Label.Highlight}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding HighlightAdjustment, StringFormat={}{0:+0.00;-0.00}}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="highlightAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Maximum="1" Minimum="-1" TickFrequency="0.01" Value="{Binding HighlightAdjustment, Mode=TwoWay}"/>
												<Separator Classes="Dialog_Separator_Small"/>

												<!-- Shadow -->
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.BrightnessAndContrastAdjustment.Label.Shadow}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding ShadowAdjustment, StringFormat={}{0:+0.00;-0.00}}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="shadowAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Maximum="1" Minimum="-1" TickFrequency="0.01" Value="{Binding ShadowAdjustment, Mode=TwoWay}"/>

											</StackPanel>
										</DockPanel>
									</Border>
								</Popup>
							</Panel>
						</ToggleButton>

						<!-- Color adjustment -->
						<ToggleButton Name="colorAdjustmentButton" Classes="ToolBar_ToggleButton" Command="{Binding $parent[UserControl].OpenColorAdjustmentPopup}" IsEnabled="{Binding IsColorAdjustmentSupported}" ToolTip.Tip="{DynamicResource String/SessionControl.ColorAdjustment}">
							<Panel>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Color}" IsVisible="{Binding !$parent[ToggleButton].IsChecked}"/>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Color.Active}">
									<Image.IsVisible>
										<MultiBinding Converter="{x:Static aConverters:BoolConverters.Or}">
											<Binding Path="HasColorAdjustment"/>
											<Binding Path="HasSaturationAdjustment"/>
											<Binding Path="HasVibranceAdjustment"/>
										</MultiBinding>
									</Image.IsVisible>
								</Image>
								<Image Classes="Icon" Source="{DynamicResource Image/Icon.Color.Light}" IsVisible="{Binding $parent[ToggleButton].IsChecked}"/>
								<Popup Name="colorAdjustmentPopup" Classes="SessionControl_FilterParamsPopup">
									<Border Name="colorAdjustmentPopupBorder" Classes="SessionControl_FilterParamsPopup">
										<DockPanel>
											<Border DockPanel.Dock="Bottom" Padding="{DynamicResource Thickness/Dialog.ControlButtonsPanel.Padding}">
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<Button Classes="Dialog_ControlButton" Command="{Binding SelectColorAdjustmentCommand}" Content="{DynamicResource String/SessionControl.SelectColorAdjustment}"/>
													<Button Classes="Dialog_ControlButton" Command="{Binding $parent[UserControl].ResetColorAdjustmentCommand}" Content="{DynamicResource String/Common.Reset}"/>
												</StackPanel>
											</Border>
											<StackPanel Classes="Dialog_ContentPanel">
												<StackPanel.Styles>
													<Style Selector="Slider">
														<Setter Property="Maximum" Value="1"/>
														<Setter Property="Minimum" Value="-1"/>
														<Setter Property="TickFrequency" Value="0.01"/>
													</Style>
												</StackPanel.Styles>
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.ColorAdjustment.Label.Red}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding RedColorAdjustment, StringFormat={}{0:+0.00;-0.00}}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="redColorAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Value="{Binding RedColorAdjustment, Mode=TwoWay}"/>
												<Separator Classes="Dialog_Separator_Small"/>
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.ColorAdjustment.Label.Green}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding GreenColorAdjustment, StringFormat={}{0:+0.00;-0.00}}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="greenColorAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Value="{Binding GreenColorAdjustment, Mode=TwoWay}"/>
												<Separator Classes="Dialog_Separator_Small"/>
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.ColorAdjustment.Label.Blue}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding BlueColorAdjustment, StringFormat={}{0:+0.00;-0.00}}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="blueColorAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Value="{Binding BlueColorAdjustment, Mode=TwoWay}"/>
												<Separator Classes="Dialog_Separator_Small"/>
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.ColorAdjustment.Label.Saturation}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding SaturationAdjustment, StringFormat={}{0:+0.00;-0.00}}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="saturationAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Value="{Binding SaturationAdjustment, Mode=TwoWay}"/>
												<Separator Classes="Dialog_Separator_Small"/>
												<StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{DynamicResource String/SessionControl.ColorAdjustment.Label.Vibrance}" VerticalAlignment="Center"/>
													<Separator Classes="Dialog_Separator_Small"/>
													<TextBlock Classes="Dialog_TextBlock" HorizontalAlignment="Center" Text="{Binding VibranceAdjustment, StringFormat={}{0:+0.00;-0.00}}" VerticalAlignment="Center"/>
												</StackPanel>
												<Slider Name="vibranceAdjustmentSlider" Classes="SessionControl_FilterParamsSlider" Value="{Binding VibranceAdjustment, Mode=TwoWay}"/>
											</StackPanel>
										</DockPanel>
									</Border>
								</Popup>
							</Panel>
						</ToggleButton>

					</StackPanel>
				</asControls:ToolBarScrollViewer>

				<!-- Other actions -->
				<StackPanel Grid.Column="1" Orientation="Horizontal">

					<!-- Test -->
					<Button Name="testButton" Classes="ToolBar_Button" Command="{Binding $parent[UserControl].OnTestButtonClick}" IsVisible="False">
						<Image Classes="Icon" Source="{DynamicResource Image/Icon.Lab}"/>
					</Button>

					<!-- Rendering params panel -->
					<ToggleButton Classes="ToolBar_ToggleButton" IsChecked="{Binding IsRenderingParametersPanelVisible}" ToolTip.Tip="{DynamicResource String/SessionControl.RenderingParametersPanel}">
						<Panel>
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.SidePanel}" IsVisible="{Binding !$parent[ToggleButton].IsChecked}"/>
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.SidePanel.Light}" IsVisible="{Binding $parent[ToggleButton].IsChecked}"/>
						</Panel>
					</ToggleButton>

					<!-- Other actions -->
					<ToggleButton Name="otherActionsButton" Classes="ToolBar_ToggleButton" Command="{Binding $parent[UserControl].ShowOtherActions}" ToolTip.Tip="{DynamicResource String/SessionControl.OtherActions}">
						<Panel>
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.More}" IsVisible="{Binding !$parent[ToggleButton].IsChecked}"/>
							<Image Classes="Icon" Source="{DynamicResource Image/Icon.More.Light}" IsVisible="{Binding $parent[ToggleButton].IsChecked}"/>
							<Border Classes="ToolBar_NotificationIndicator" IsVisible="{Binding $parent[Window].Application.UpdateInfo, Converter={x:Static asConverters:ValueToBooleanConverters.NonNullToTrue}}">
								<Image Classes="ToolBar_NotificationIndicator" Source="{DynamicResource Image/Icon.Update.Colored}"/>
							</Border>
						</Panel>
					</ToggleButton>

				</StackPanel>

			</Grid>
		</Border>
		<ProgressBar Background="{x:Null}" CornerRadius="0" IsIndeterminate="True" IsVisible="{Binding IsProcessingImage}" MaxHeight="{DynamicResource Double/SessionControl.ImageProgressBar.Height}" MinHeight="{DynamicResource Double/SessionControl.ImageProgressBar.Height}" VerticalAlignment="Bottom"/>

		<!-- Viewer -->
		<Grid Name="workingAreaGrid" Grid.Row="1">

			<!-- Columns -->
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition MaxWidth="{x:Static appViewModels:Session.MaxRenderingParametersPanelSize}" MinWidth="{x:Static appViewModels:Session.MinRenderingParametersPanelSize}" Width="0"/>
			</Grid.ColumnDefinitions>

			<!-- Histograms -->
			<Border Background="{DynamicResource Brush/WorkingArea.Background}"/>
			<Border Background="{DynamicResource Brush/WorkingArea.Panel.Background}" BorderBrush="{DynamicResource Brush/Control.Border.Dark}" BorderThickness="0,0,1,0" IsVisible="{Binding IsHistogramsVisible}" Width="{DynamicResource Double/SessionControl.HistogramsPanel.Width}">
				<ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
					<StackPanel Margin="{DynamicResource Thickness/SessionControl.HistogramsPanel.Padding}">

						<!-- Styles -->
						<StackPanel.Styles>
							<Style Selector="appControls|BitmapHistogramsView">
								<Setter Property="Height" Value="{DynamicResource Double/SessionControl.Histogram.Height}"/>
								<Setter Property="HorizontalAlignment" Value="Stretch"/>
							</Style>
						</StackPanel.Styles>

						<!-- Luminance -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.Histogram.Luminance}"/>
						<appControls:BitmapHistogramsView DataContext="{Binding Histograms}" IsLuminanceHistogramVisible="True"/>
						<Separator Classes="Dialog_Separator"/>

						<!-- Red -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.Histogram.Red}"/>
						<appControls:BitmapHistogramsView DataContext="{Binding Histograms}" IsRedHistogramVisible="True"/>
						<Separator Classes="Dialog_Separator"/>

						<!-- Green -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.Histogram.Green}"/>
						<appControls:BitmapHistogramsView DataContext="{Binding Histograms}" IsGreenHistogramVisible="True"/>
						<Separator Classes="Dialog_Separator"/>

						<!-- Blue -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.Histogram.Blue}"/>
						<appControls:BitmapHistogramsView DataContext="{Binding Histograms}" IsBlueHistogramVisible="True"/>
						
					</StackPanel>
				</ScrollViewer>
			</Border>

			<!-- Image viewer -->
			<Grid Name="imageViewerGrid" Background="{DynamicResource Brush/WorkingArea.Background}" DragDrop.AllowDrop="True" Grid.Column="1" RowDefinitions="*,Auto">

				<!-- Hint -->
				<Viewbox Margin="{DynamicResource Thickness/SessionControl.ImageViewer.Padding}" Stretch="Uniform" StretchDirection="DownOnly">
					<Panel>

						<!-- Drag-drop hint -->
						<Border IsVisible="{Binding !IsOpeningSourceFile}">
							<StackPanel HorizontalAlignment="Center" IsVisible="{Binding !IsSourceFileOpened}" Orientation="Horizontal" VerticalAlignment="Center">
								<TextBlock Classes="SessionControl_ImageViewer_Hint_TextBlock" Text="{DynamicResource String/SessionControl.DragDropHint.Section1}"/>
								<Image Classes="SessionControl_ImageViewer_Hint_Icon" Source="{DynamicResource Image/Icon.OpenFile}"/>
								<TextBlock Classes="SessionControl_ImageViewer_Hint_TextBlock" Text="{DynamicResource String/SessionControl.DragDropHint.Section2}"/>
							</StackPanel>
						</Border>

						<!-- Opening file hint -->
						<StackPanel HorizontalAlignment="Center" IsVisible="{Binding IsOpeningSourceFile}" Orientation="Horizontal" VerticalAlignment="Center">
							<Image Classes="SessionControl_ImageViewer_Hint_Icon" Source="{DynamicResource Image/Icon.OpenFile}"/>
							<TextBlock Classes="SessionControl_ImageViewer_Hint_TextBlock" Text="{DynamicResource String/SessionControl.OpeningSourceFile}"/>
						</StackPanel>

						<!-- Insufficient memory hint -->
						<StackPanel HorizontalAlignment="Center" IsVisible="{Binding InsufficientMemoryForRenderedImage}" Orientation="Horizontal" VerticalAlignment="Center">
							<Image Classes="SessionControl_ImageViewer_Hint_Icon" Source="{DynamicResource Image/Icon.Warning}"/>
							<TextBlock Classes="SessionControl_ImageViewer_Hint_TextBlock" Text="{DynamicResource String/SessionControl.InsufficientMemoryForRenderedImageHint}"/>
						</StackPanel>

						<!-- Rendering error -->
						<StackPanel HorizontalAlignment="Center" IsVisible="{Binding HasRenderingError}" Orientation="Horizontal" VerticalAlignment="Center">
							<Image Classes="SessionControl_ImageViewer_Hint_Icon" Source="{DynamicResource Image/Icon.Error}"/>
							<TextBlock Classes="SessionControl_ImageViewer_Hint_TextBlock" Text="{DynamicResource String/SessionControl.RenderingErrorOccurred}"/>
						</StackPanel>

					</Panel>
				</Viewbox>

				<!-- Image -->
				<ScrollViewer x:Name="imageScrollViewer" AllowAutoHide="False" HorizontalScrollBarVisibility="{Binding !FitImageToViewport, Converter={x:Static appControls:SessionControl.BooleanToScrollBarVisibilityConverter}}" PointerPressed="OnImageScrollViewerPointerPressed" VerticalScrollBarVisibility="{Binding !FitImageToViewport, Converter={x:Static appControls:SessionControl.BooleanToScrollBarVisibilityConverter}}">
					<Panel Margin="{DynamicResource Thickness/SessionControl.ImageViewer.Padding}" UseLayoutRounding="True">
						<Border Name="imageContainerBorder" HorizontalAlignment="Center" VerticalAlignment="Center">
							<Border.Background>
								<ImageBrush DestinationRect="0,0,20,20" Source="/Resources/RenderedImageBackground.png" TileMode="Tile"/>
							</Border.Background>
							<LayoutTransformControl>
								<Border>
									<Image x:Name="image" DoubleTapped="OnImageDoubleTapped" Height="{Binding ImageDisplaySize.Height}" HorizontalAlignment="Center" PointerLeave="OnImagePointerLeave" PointerMoved="OnImagePointerMoved" PointerPressed="OnImagePointerPressed" PointerReleased="OnImagePointerReleased" RenderOptions.BitmapInterpolationMode="{Binding $parent[UserControl].EffectiveRenderedImageInterpolationMode}" Source="{Binding $parent[UserControl].EffectiveRenderedImage}" VerticalAlignment="Center" Width="{Binding ImageDisplaySize.Width}"/>
								</Border>
								<LayoutTransformControl.LayoutTransform>
									<RotateTransform Angle="{Binding ImageDisplayRotation}"/>
								</LayoutTransformControl.LayoutTransform>
							</LayoutTransformControl>
						</Border>
						<Canvas ClipToBounds="False" Height="{Binding #imageContainerBorder.Bounds.Height}" HorizontalAlignment="Center" IsVisible="{Binding HasRenderedImage}" VerticalAlignment="Center" Width="{Binding #imageContainerBorder.Bounds.Width}"/>
					</Panel>
				</ScrollViewer>

				<!-- Pixel information -->
				<Border Classes="StatusBar" Background="{DynamicResource Brush/WorkingArea.Panel.Background}" BorderBrush="{DynamicResource Brush/Control.Border.Light}" BorderThickness="0,1,0,0" Grid.Row="1" IsVisible="{Binding HasRenderedImage}">
					<Border.Styles>
						<Style Selector="TextBlock">
							<Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
							<Setter Property="Margin" Value="{DynamicResource Thickness/StatusBar.Item.Margin}"/>
							<Setter Property="VerticalAlignment" Value="Center"/>
						</Style>
					</Border.Styles>
					<Panel>
						<TextBlock Opacity="0" Text="{DynamicResource String/SessionControl.SelectedPixel.None}"/>
						<TextBlock IsVisible="{Binding !HasSelectedRenderedImagePixel}" Text="{DynamicResource String/SessionControl.SelectedPixel.None}" TextWrapping="Wrap"/>
						<WrapPanel Opacity="{Binding HasSelectedRenderedImagePixel, Converter={x:Static asConverters:BooleanToValueConverters.BooleanToOpacity}}" Orientation="Horizontal">
							
							<!-- Position -->
							<StackPanel Orientation="Horizontal">
								<Image Classes="StatusBar_Icon" Source="{DynamicResource Image/Icon.Coordinates}"/>
								<Panel>
									<TextBlock Text="(0000, 0000)" Opacity="0"/>
									<TextBlock>
										<TextBlock.Text>
											<MultiBinding StringFormat="{}({0}, {1})">
												<Binding Path="SelectedRenderedImagePixelPositionX"/>
												<Binding Path="SelectedRenderedImagePixelPositionY"/>
											</MultiBinding>
										</TextBlock.Text>
									</TextBlock>
								</Panel>
								<Separator Classes="StatusBar_Separator"/>
							</StackPanel>

							<!-- Color -->
							<StackPanel Orientation="Horizontal">
								<Border BorderBrush="{DynamicResource SystemControlForegroundBaseHighBrush}" BorderThickness="1" Height="{DynamicResource Double/StatusBar.Icon.Size}" Width="{DynamicResource Double/StatusBar.Icon.Size}">
									<Border.Background>
										<SolidColorBrush Color="{Binding SelectedRenderedImagePixelColor}"/>
									</Border.Background>
								</Border>
								<Separator Classes="StatusBar_Separator"/>
							</StackPanel>

							<!-- ARGB Color -->
							<StackPanel IsVisible="{Binding $parent[UserControl].ShowSelectedRenderedImagePixelArgbColor}" Orientation="Horizontal">
								<Panel>
									<TextBlock Text="ARGB(000, 000, 000, 000)" Opacity="0"/>
									<TextBlock>
										<TextBlock.Text>
											<MultiBinding StringFormat="{}ARGB({0}, {1}, {2}, {3})">
												<Binding Path="SelectedRenderedImagePixelColor.A"/>
												<Binding Path="SelectedRenderedImagePixelColor.R"/>
												<Binding Path="SelectedRenderedImagePixelColor.G"/>
												<Binding Path="SelectedRenderedImagePixelColor.B"/>
											</MultiBinding>
										</TextBlock.Text>
									</TextBlock>
								</Panel>
								<Separator Classes="StatusBar_Separator"/>
							</StackPanel>

							<!-- CIELAB Color -->
							<StackPanel IsVisible="{Binding $parent[UserControl].ShowSelectedRenderedImagePixelLabColor}" Orientation="Horizontal">
								<Panel>
									<TextBlock Text="L*a*b*(000.00, 000.00, 000.00)" Opacity="0"/>
									<TextBlock>
										<TextBlock.Text>
											<MultiBinding StringFormat="{}L*a*b*({0:F2}, {1:F2}, {2:F2})">
												<Binding Path="SelectedRenderedImagePixelLabColor.Item1"/>
												<Binding Path="SelectedRenderedImagePixelLabColor.Item2"/>
												<Binding Path="SelectedRenderedImagePixelLabColor.Item3"/>
											</MultiBinding>
										</TextBlock.Text>
									</TextBlock>
								</Panel>
								<Separator Classes="StatusBar_Separator"/>
							</StackPanel>

							<!-- XYZ Color -->
							<Panel IsVisible="{Binding $parent[UserControl].ShowSelectedRenderedImagePixelXyzColor}">
								<TextBlock Text="XYZ(000.00, 000.00, 000.00)" Opacity="0"/>
								<TextBlock>
									<TextBlock.Text>
										<MultiBinding StringFormat="{}XYZ({0:F2}, {1:F2}, {2:F2})">
											<Binding Path="SelectedRenderedImagePixelXyzColor.Item1"/>
											<Binding Path="SelectedRenderedImagePixelXyzColor.Item2"/>
											<Binding Path="SelectedRenderedImagePixelXyzColor.Item3"/>
										</MultiBinding>
									</TextBlock.Text>
								</TextBlock>
							</Panel>
						</WrapPanel>
					</Panel>
				</Border>
				
			</Grid>

			<!-- Rendering parameters panel -->
			<Border Background="{DynamicResource Brush/WorkingArea.Panel.Background}" Grid.Column="3" IsVisible="{Binding IsRenderingParametersPanelVisible}">
				<ScrollViewer Name="renderingParamsPanelScrollViewer" HorizontalScrollBarVisibility="Disabled">
					<StackPanel IsEnabled="{Binding IsSourceFileOpened}" Margin="{DynamicResource Thickness/SessionControl.OptionsPanel.Padding}">

						<!-- Styles -->
						<StackPanel.Styles>
							<Style Selector="asControls|IntegerTextBox">
								<Setter Property="IsNullValueAllowed" Value="False"/>
							</Style>
							<Style Selector="TextBlock">
								<Setter Property="TextTrimming" Value="CharacterEllipsis"/>
							</Style>
						</StackPanel.Styles>

						<!-- Profile -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.Profile}"/>
						<ComboBox Classes="Dialog_ComboBox" Items="{Binding Profiles}" SelectedItem="{Binding Profile, Mode=TwoWay}">
							<ComboBox.ItemTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal">
										<Border Height="{DynamicResource Double/SessionControl.ImageRenderingProfile.Icon.Size}" Margin="{DynamicResource Thickness/SessionControl.ImageRenderingProfile.Icon.Margin}" VerticalAlignment="Center" Width="{DynamicResource Double/SessionControl.ImageRenderingProfile.Icon.Size}">
											<Image Classes="Icon" Source="{Binding Converter={x:Static appConverters:ImageRenderingProfileIconConverter.Default}}"/>
										</Border>
										<TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
									</StackPanel>
								</DataTemplate>
							</ComboBox.ItemTemplate>
						</ComboBox>
						<Separator Classes="Dialog_Separator"/>

						<!-- Data offset -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.DataOffset}"/>
						<asControls:IntegerTextBox Classes="Dialog_TextBlock" Minimum="0" Value="{Binding DataOffset, Mode=TwoWay}"/>
						<Separator Classes="Dialog_Separator"/>

						<!-- Frame padding bytes -->
						<StackPanel IsVisible="{Binding HasMultipleFrames}">
							<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.FramePaddingSize}"/>
							<asControls:IntegerTextBox Classes="Dialog_TextBlock" Minimum="0" Value="{Binding FramePaddingSize, Mode=TwoWay}"/>
							<Separator Classes="Dialog_Separator"/>
						</StackPanel>

						<!-- Image renderer -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.ImageRenderer}"/>
						<ComboBox Name="imageRendererComboBox" Classes="Dialog_ComboBox" Items="{x:Static appImageRenderers:ImageRenderers.All}" SelectedItem="{Binding ImageRenderer, Mode=TwoWay}">
							<ComboBox.ItemTemplate>
								<DataTemplate>
									<Grid ColumnDefinitions="*,Auto">
										<TextBlock Text="{Binding Format, Converter={x:Static appConverters:ImageFormatConverter.Default}}" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis"/>
										<Border Background="{Binding Format.Category, Converter={x:Static appConverters:ImageFormatCategoryToBrushConverter.Default}}" BorderBrush="{DynamicResource Brush/SessionControl.ImageFormatCategoryLabel.Border}" BorderThickness="{DynamicResource Thickness/SessionControl.ImageFormatCategoryLabel.Border}" CornerRadius="{DynamicResource CornerRadius/SessionControl.ImageFormatCategoryLabel}" Grid.Column="1" Margin="{DynamicResource Thickness/SessionControl.ImageFormatCategoryLabel.Margin}" Padding="{DynamicResource Thickness/SessionControl.ImageFormatCategoryLabel.Padding}" VerticalAlignment="Center">
											<TextBlock FontSize="{DynamicResource Double/SessionControl.ImageFormatCategoryLabel.FontSize}" FontWeight="Bold" Foreground="{DynamicResource Brush/SessionControl.ImageFormatCategoryLabel.Foreground}" Text="{Binding Format.Category, Converter={x:Static appConverters:EnumConverters.ImageFormatCategory}}"/>
										</Border>
									</Grid>
								</DataTemplate>
							</ComboBox.ItemTemplate>
						</ComboBox>
						<Separator Classes="Dialog_Separator"/>

						<!-- Byte ordering -->
						<StackPanel IsVisible="{Binding HasMultipleByteOrderings}">
							<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.ByteOrdering}"/>
							<asControls:EnumComboBox Classes="Dialog_ComboBox" EnumType="{x:Type app:ByteOrdering}" SelectedItem="{Binding ByteOrdering, Mode=TwoWay}"/>
							<Separator Classes="Dialog_Separator"/>
						</StackPanel>

						<!-- Bayer Pattern -->
						<StackPanel IsVisible="{Binding IsBayerPatternSupported}">
							<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.BayerPattern}"/>
							<asControls:EnumComboBox Classes="Dialog_ComboBox" EnumType="{x:Type appMedia:BayerPattern}" SelectedItem="{Binding BayerPattern, Mode=TwoWay}"/>
							<Separator Classes="Dialog_Separator"/>
						</StackPanel>

						<!-- YUV to RGB converte -->
						<StackPanel IsVisible="{Binding IsYuvToBgraConverterSupported}">
							<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.YuvToBgraConverter}"/>
							<ComboBox Classes="Dialog_ComboBox" Items="{x:Static appMedia:YuvToBgraConverter.All}" SelectedItem="{Binding YuvToBgraConverter, Mode=TwoWay}">
								<ComboBox.ItemTemplate>
									<DataTemplate>
										<TextBlock Text="{Binding Converter={x:Static appConverters:YuvToBgraConverterToStringConverter.Default}}"/>
									</DataTemplate>
								</ComboBox.ItemTemplate>
							</ComboBox>
							<Separator Classes="Dialog_Separator"/>
						</StackPanel>

						<!-- Color space -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.ColorSpace}"/>
						<Panel>
							<asControls:LinkTextBlock Command="{Binding $parent[UserControl].ShowColorSpaceManagementOptions}" IsVisible="{Binding !IsColorSpaceManagementEnabled}" Text="{DynamicResource String/SessionControl.ColorSpace.Disabled}" TextWrapping="Wrap"/>
							<ComboBox Classes="Dialog_ComboBox" IsVisible="{Binding IsColorSpaceManagementEnabled}" Items="{x:Static appMedia:ColorSpace.BuiltInColorSpaces}" SelectedItem="{Binding ColorSpace, Mode=TwoWay}">
								<ComboBox.ItemTemplate>
									<DataTemplate>
										<TextBlock Text="{Binding Converter={x:Static appConverters:ColorSpaceToStringConverter.Default}}"/>
									</DataTemplate>
								</ComboBox.ItemTemplate>
							</ComboBox>
						</Panel>
						<Separator Classes="Dialog_Separator"/>

						<!-- Demisaicing -->
						<StackPanel IsVisible="{Binding IsDemosaicingSupported}">
							<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.Demosaicing}"/>
							<ToggleSwitch Classes="Dialog_ToggleSwitch" IsChecked="{Binding Demosaicing, Mode=TwoWay}"/>
							<Separator Classes="Dialog_Separator"/>
						</StackPanel>

						<!-- Dimensions -->
						<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.ImageDimensions}"/>
						<Grid ColumnDefinitions="*,Auto,*">
							<asControls:IntegerTextBox Classes="Dialog_TextBox" Maximum="65535" Minimum="1" Value="{Binding ImageWidth, Mode=TwoWay}"/>
							<TextBlock Grid.Column="1" Text=" Ã— " VerticalAlignment="Center"/>
							<asControls:IntegerTextBox Classes="Dialog_TextBox" Grid.Column="2" Maximum="65535" Minimum="1" Value="{Binding ImageHeight, Mode=TwoWay}"/>
						</Grid>
						<Separator Classes="Dialog_Separator_Small"/>
						<ToggleButton Name="evaluateImageDimensionsButton" Classes="SessionControl_OptionsPanel_ToggleButton" Command="{Binding $parent[UserControl].ShowEvaluateImageDimensionsMenuCommand}" Content="{DynamicResource String/SessionControl.EvaluateImageDimensions}" IsEnabled="{Binding CanChangeImageRenderer}"/>
						<Separator Classes="Dialog_Separator"/>

						<!-- Plane options #1 -->
						<Expander Classes="SessionControl_OptionsPanel_Expander" Header="{DynamicResource String/SessionControl.ImagePlaneOptions.1}" IsExpanded="True" IsVisible="{Binding HasImagePlane1}">
							<StackPanel>
								<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.RowStride}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" Value="{Binding RowStride1, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator" IsVisible="{Binding IsAdjustablePixelStride1}"/>
								<TextBlock Classes="Dialog_TextBlock" IsVisible="{Binding IsAdjustablePixelStride1}" Text="{DynamicResource String/SessionControl.PixelStride}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" IsVisible="{Binding IsAdjustablePixelStride1}" Value="{Binding PixelStride1, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator" IsVisible="{Binding IsAdjustableEffectiveBits1}"/>
								<TextBlock Classes="Dialog_TextBlock" IsVisible="{Binding IsAdjustableEffectiveBits1}" Text="{DynamicResource String/SessionControl.EffectiveBits}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" IsVisible="{Binding IsAdjustableEffectiveBits1}" Minimum="1" Value="{Binding EffectiveBits1, Mode=TwoWay}"/>
							</StackPanel>
						</Expander>
						<Separator Classes="Dialog_Separator" IsVisible="{Binding HasImagePlane1}"/>

						<!-- Plane options #2 -->
						<Expander Classes="SessionControl_OptionsPanel_Expander" Header="{DynamicResource String/SessionControl.ImagePlaneOptions.2}" IsExpanded="True" IsVisible="{Binding HasImagePlane2}">
							<StackPanel>
								<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.RowStride}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" Value="{Binding RowStride2, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator" IsVisible="{Binding IsAdjustablePixelStride2}"/>
								<TextBlock Classes="Dialog_TextBlock" IsVisible="{Binding IsAdjustablePixelStride2}" Text="{DynamicResource String/SessionControl.PixelStride}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" IsVisible="{Binding IsAdjustablePixelStride2}" Value="{Binding PixelStride2, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator" IsVisible="{Binding IsAdjustableEffectiveBits2}"/>
								<TextBlock Classes="Dialog_TextBlock" IsVisible="{Binding IsAdjustableEffectiveBits2}" Text="{DynamicResource String/SessionControl.EffectiveBits}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" IsVisible="{Binding IsAdjustableEffectiveBits2}" Minimum="1" Value="{Binding EffectiveBits2, Mode=TwoWay}"/>
							</StackPanel>
						</Expander>
						<Separator Classes="Dialog_Separator" IsVisible="{Binding HasImagePlane2}"/>

						<!-- Plane options #3 -->
						<Expander Classes="SessionControl_OptionsPanel_Expander" Header="{DynamicResource String/SessionControl.ImagePlaneOptions.3}" IsExpanded="True" IsVisible="{Binding HasImagePlane3}">
							<StackPanel>
								<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.RowStride}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" Value="{Binding RowStride3, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator" IsVisible="{Binding IsAdjustablePixelStride3}"/>
								<TextBlock Classes="Dialog_TextBlock" IsVisible="{Binding IsAdjustablePixelStride3}" Text="{DynamicResource String/SessionControl.PixelStride}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" IsVisible="{Binding IsAdjustablePixelStride3}" Value="{Binding PixelStride3, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator" IsVisible="{Binding IsAdjustableEffectiveBits3}"/>
								<TextBlock Classes="Dialog_TextBlock" IsVisible="{Binding IsAdjustableEffectiveBits3}" Text="{DynamicResource String/SessionControl.EffectiveBits}"/>
								<asControls:IntegerTextBox Classes="Dialog_TextBox" IsVisible="{Binding IsAdjustableEffectiveBits3}" Minimum="1" Value="{Binding EffectiveBits3, Mode=TwoWay}"/>
							</StackPanel>
						</Expander>
						<Separator Classes="Dialog_Separator" IsVisible="{Binding HasImagePlane3}"/>

						<!-- RGB gain -->
						<Expander Classes="SessionControl_OptionsPanel_Expander" Header="{DynamicResource String/SessionControl.RgbGain}" IsExpanded="True" IsVisible="{Binding IsRgbGainSupported}">
							<StackPanel>
								<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.RedColorGain}"/>
								<NumericUpDown Classes="Dialog_NumericUpDown" FormatString="F2" Maximum="{x:Static appImageRenderers:ImageRenderingOptions.MaxRgbGain}" Minimum="{x:Static appImageRenderers:ImageRenderingOptions.MinRgbGain}" Increment="0.1" Value="{Binding RedColorGain, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator"/>
								<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.GreenColorGain}"/>
								<NumericUpDown Classes="Dialog_NumericUpDown" FormatString="F2" Maximum="{x:Static appImageRenderers:ImageRenderingOptions.MaxRgbGain}" Minimum="{x:Static appImageRenderers:ImageRenderingOptions.MinRgbGain}" Increment="0.1" Value="{Binding GreenColorGain, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator"/>
								<TextBlock Classes="Dialog_TextBlock" Text="{DynamicResource String/SessionControl.BlueColorGain}"/>
								<NumericUpDown Classes="Dialog_NumericUpDown" FormatString="F2" Maximum="{x:Static appImageRenderers:ImageRenderingOptions.MaxRgbGain}" Minimum="{x:Static appImageRenderers:ImageRenderingOptions.MinRgbGain}" Increment="0.1" Value="{Binding BlueColorGain, Mode=TwoWay}"/>
								<Separator Classes="Dialog_Separator"/>
								<Button Classes="SessionControl_OptionsPanel_Button" Command="{Binding SelectRgbGainCommand}" Content="{DynamicResource String/SessionControl.SelectRgbGain}"/>
								<Separator Classes="Dialog_Separator_Small"/>
								<Button Classes="SessionControl_OptionsPanel_Button" Command="{Binding ResetRgbGainCommand}" Content="{DynamicResource String/Common.Reset}"/>
							</StackPanel>
						</Expander>
						<Separator Classes="Dialog_Separator" IsVisible="{Binding IsRgbGainSupported}"/>

						<!-- Apply profile -->
						<Button Classes="SessionControl_OptionsPanel_Button" Command="{Binding ApplyProfileCommand}" Content="{DynamicResource String/SessionControl.ApplyProfile}"/>
						<Separator Classes="Dialog_Separator_Small"/>

						<!-- Save profile -->
						<Button Classes="SessionControl_OptionsPanel_Button" Command="{Binding SaveProfileCommand}" Content="{DynamicResource String/SessionControl.SaveProfile}"/>
						<Separator Classes="Dialog_Separator_Small"/>

						<!-- Save as new profile -->
						<Button Classes="SessionControl_OptionsPanel_Button" Command="{Binding $parent[UserControl].SaveAsNewProfileCommand}" Content="{DynamicResource String/SessionControl.SaveAsNewProfile}"/>
						<Separator Classes="Dialog_Separator_Small"/>

						<!-- Delete profile -->
						<Button Classes="SessionControl_OptionsPanel_Button" Command="{Binding DeleteProfileCommand}" Content="{DynamicResource String/SessionControl.DeleteProfile}"/>

					</StackPanel>
				</ScrollViewer>
			</Border>

			<!-- Splitter -->
			<GridSplitter Background="{DynamicResource Brush/WorkingArea.Panel.Background}" BorderBrush="{DynamicResource Brush/Control.Border.Light}" BorderThickness="1,0,0,0" Classes="GridSplitter_Vertical" DragCompleted="OnOptionsPanelSplitterDragCompleted" DragStarted="OnOptionsPanelSplitterDragStarted" Grid.Column="2" IsVisible="{Binding IsRenderingParametersPanelVisible}"/>
			
		</Grid>

		<!-- Status bar -->
		<Border Background="{x:Null}" Classes="StatusBar" Grid.Row="2">

			<ia:Interaction.Behaviors>
				<iaCore:DataTriggerBehavior Binding="{Binding $parent[UserControl].StatusBarState}" Value="Inactive">
					<iaCore:ChangePropertyAction PropertyName="Background" Value="{StaticResource Brush/SessionControl.StatusBar.Background.Inactive}"/>
				</iaCore:DataTriggerBehavior>
				<iaCore:DataTriggerBehavior Binding="{Binding $parent[UserControl].StatusBarState}" Value="Error">
					<iaCore:ChangePropertyAction PropertyName="Background" Value="{StaticResource Brush/SessionControl.StatusBar.Background.Error}"/>
				</iaCore:DataTriggerBehavior>
				<iaCore:DataTriggerBehavior Binding="{Binding $parent[UserControl].StatusBarState}" Value="Active">
					<iaCore:ChangePropertyAction PropertyName="Background" Value="{StaticResource Brush/StatusBar.Background}"/>
				</iaCore:DataTriggerBehavior>
			</ia:Interaction.Behaviors>
			
			<Grid ColumnDefinitions="*,Auto" HorizontalAlignment="Stretch">

				<!-- Reserve -->
				<TextBlock Classes="StatusBar_TextBlock" Grid.ColumnSpan="2" Text="{DynamicResource String/SessionControl.NoSourceFileOpened}" Opacity="0"/>

				<!-- Left part -->
				<StackPanel ClipToBounds="True" Orientation="Horizontal">

					<!-- File actions -->
					<StackPanel Orientation="Horizontal">
						<TextBlock Classes="StatusBar_TextBlock" IsVisible="{Binding !IsSourceFileOpened}" Text="{DynamicResource String/SessionControl.NoSourceFileOpened}"/>
						<ToggleButton Name="fileActionsButton" Classes="StatusBar_ToggleButton" Command="{Binding $parent[UserControl].ShowFileActions}" IsVisible="{Binding IsSourceFileOpened}" MaxWidth="{DynamicResource Double/SessionControl.StatusBar.FileActions.MaxWidth}">
							<StackPanel Orientation="Horizontal">
								<Image Classes="StatusBar_Icon">
									<DrawingImage>
										<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.File}"/>
									</DrawingImage>
								</Image>
								<TextBlock Text="{Binding SourceFileSizeString}"/>
								<Image Classes="StatusBar_DropDownIcon">
									<DrawingImage>
										<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.MoveUp}"/>
									</DrawingImage>
								</Image>
							</StackPanel>
						</ToggleButton>
						<Separator Classes="StatusBar_Separator"/>
					</StackPanel>

					<!-- Source data size -->
					<StackPanel Background="{x:Static Brushes.Transparent}" IsVisible="{Binding HasRenderedImage}" Orientation="Horizontal" ToolTip.Placement="Left" ToolTip.Tip="{DynamicResource String/SessionControl.SourceDataSize}">
						<Image Classes="StatusBar_Icon">
							<DrawingImage>
								<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.BinaryData}"/>
							</DrawingImage>
						</Image>
						<TextBlock Classes="StatusBar_TextBlock" Text="{Binding SourceDataSize, StringFormat={}{0:N0} }"/>
						<TextBlock Classes="StatusBar_TextBlock" Text="{DynamicResource String/Common.Bytes}"/>
					</StackPanel>
					<Separator Classes="StatusBar_Separator" IsVisible="{Binding HasRenderedImage}"/>

				</StackPanel>

				<!-- Right part -->
				<StackPanel Grid.Column="1" Orientation="Horizontal">
					
					<!-- Saving image -->
					<StackPanel IsVisible="{Binding IsSavingImage}" Orientation="Horizontal">
						<Separator Classes="StatusBar_Separator"/>
						<Image Classes="StatusBar_Icon">
							<DrawingImage>
								<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.Save}"/>
							</DrawingImage>
						</Image>
						<TextBlock Classes="StatusBar_TextBlock" Text="{DynamicResource String/SessionControl.SavingRenderedImage}"/>
					</StackPanel>

					<!-- Filtering image -->
					<StackPanel IsVisible="{Binding IsFilteringRenderedImage}" Orientation="Horizontal">
						<Separator Classes="StatusBar_Separator"/>
						<Image Classes="StatusBar_Icon">
							<DrawingImage>
								<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.ImageFilter}"/>
							</DrawingImage>
						</Image>
						<TextBlock Classes="StatusBar_TextBlock" Text="{DynamicResource String/SessionControl.FilteringRenderedImage}"/>
					</StackPanel>

					<!-- Rendering image -->
					<StackPanel IsVisible="{Binding IsRenderingImage}" Orientation="Horizontal">
						<Separator Classes="StatusBar_Separator"/>
						<Image Classes="StatusBar_Icon">
							<DrawingImage>
								<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.Waiting}"/>
							</DrawingImage>
						</Image>
						<Panel>
							<TextBlock Classes="StatusBar_TextBlock" IsVisible="{Binding IsConvertingColorSpace}" Text="{DynamicResource String/SessionControl.ConvertingColorSpace}"/>
							<TextBlock Classes="StatusBar_TextBlock" IsVisible="{Binding !IsConvertingColorSpace}" Text="{DynamicResource String/SessionControl.RenderingImage}"/>
						</Panel>
					</StackPanel>

					<!-- Process info -->
					<StackPanel IsVisible="{Binding $parent[UserControl].ShowProcessInfo}" Orientation="Horizontal">
						
						<!-- UI response duration -->
						<StackPanel IsVisible="{Binding Source={x:Static app:App.Current}, Path=IsDebugMode}" Orientation="Horizontal">
							<Separator Classes="StatusBar_Separator"/>
							<Image Classes="StatusBar_Icon">
								<DrawingImage>
									<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.Speed}"/>
								</DrawingImage>
							</Image>
							<Panel>
								<TextBlock Classes="StatusBar_TextBlock" Opacity="0" Text="000 ms   "/>
								<TextBlock Classes="StatusBar_TextBlock" HorizontalAlignment="Left" Text="{Binding Source={x:Static app:App.Current}, Path=ProcessInfo.UIResponseDuration, Converter={x:Static asConverters:TimeSpanConverter.Default}}" ToolTip.Placement="Left" ToolTip.Tip="{DynamicResource String/SessionControl.UIResponseDuration}"/>
							</Panel>
						</StackPanel>

						<!-- CPU usage -->
						<Separator Classes="StatusBar_Separator"/>
						<Image Classes="StatusBar_Icon">
							<DrawingImage>
								<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.Cpu}"/>
							</DrawingImage>
						</Image>
						<Panel>
							<TextBlock Classes="StatusBar_TextBlock" Opacity="0" Text="00.0%"/>
							<TextBlock Classes="StatusBar_TextBlock" HorizontalAlignment="Left" Text="{Binding Source={x:Static app:App.Current}, Path=ProcessInfo.CpuUsagePercentage, StringFormat={}{0:F1}%}" ToolTip.Placement="Left" ToolTip.Tip="{DynamicResource String/SessionControl.CpuUsage}"/>
						</Panel>

						<!-- Memory usage -->
						<Separator Classes="StatusBar_Separator"/>
						<Image Classes="StatusBar_Icon">
							<DrawingImage>
								<GeometryDrawing Brush="{DynamicResource Brush/StatusBar.Foreground}" Geometry="{DynamicResource Geometry/Icon.Memory}"/>
							</DrawingImage>
						</Image>
						<Panel>
							<TextBlock Classes="StatusBar_TextBlock" Opacity="0" Text="000.0%"/>
							<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
								<TextBlock Classes="StatusBar_TextBlock" Text="{Binding RenderedImagesMemoryUsage, Converter={x:Static asConverters:FileSizeConverter.Default}}" ToolTip.Placement="Left" ToolTip.Tip="{DynamicResource String/SessionControl.RenderedImagesMemoryUsage}"/>
								<TextBlock Classes="StatusBar_TextBlock" Text="{Binding TotalRenderedImagesMemoryUsage, Converter={x:Static asConverters:FileSizeConverter.Default}, StringFormat={}/{0}}" ToolTip.Placement="Left" ToolTip.Tip="{DynamicResource String/SessionControl.TotalRenderedImagesMemoryUsage}"/>
								<TextBlock Classes="StatusBar_TextBlock" Text="{Binding Source={x:Static app:App.Current}, Path=ProcessInfo.PrivateMemoryUsage, Converter={x:Static asConverters:FileSizeConverter.Default}, StringFormat={}/{0}}}" ToolTip.Placement="Left" ToolTip.Tip="{DynamicResource String/SessionControl.PrivateMemoryUsage}"/>
							</StackPanel>
						</Panel>

					</StackPanel>

				</StackPanel>
				
			</Grid>
		</Border>
		
	</Grid>
</UserControl>
